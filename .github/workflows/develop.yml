name: Develop

on:
  push:
    branches:
      - develop

permissions:
  contents: write

jobs:
  Develop:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-tags: true
      - name: Git config
        uses: ./.github/actions/git-config
      - name: Git tag
        id: tag
        run: echo "TAG_NAME=$(npm version prerelease --preid=rc)" >> $GITHUB_ENV
      - name: Manfiest version amend
        run: node ./scripts/syncManifestVersion.js && git add -A && git commit --amend --no-edit
      - name: Git push
        run: |
          git push
          git push --tags
      - name: Install dependencies
        run: npm ci
      - name: Dotenv config
        run: |
          touch .env
          echo "$DISCORD_WEBHOOK"
          echo DISCORD_WEBHOOK="$DISCORD_WEBHOOK" >> .env
          ls
          npm run build
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      # - name: Build
      #   run: npm run build
      # - name: Build
      #   uses: ./.github/actions/build
      #   with:
      #     discord_webhook: ${{ secrets.DISCORD_WEBHOOK }}
      - name: Pre-release
        uses: softprops/action-gh-release@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          tag_name: ${{ env.TAG_NAME }}
          prerelease: true
          generate_release_notes: true
          files: |
            ./dist/PockestHelper.zip
